From 583c44395ccc0e052c8db5217bd51fc21f7ffbb7 Mon Sep 17 00:00:00 2001
From: Hiltjo Posthuma <hiltjo@codemadness.org>
Date: Sun, 3 Feb 2019 15:24:34 +0100
Subject: [PATCH 1/8] fix compile: libgit2 0.28 changed giterr_last to
 git_error_last

libgit2 commit:
https://github.com/libgit2/libgit2/commit/a27a4de6f8003961d38958893c6c637395c7cc04
---
 stagit-index.c | 4 +---
 stagit.c       | 4 +---
 2 files changed, 2 insertions(+), 6 deletions(-)

diff --git a/stagit-index.c b/stagit-index.c
index e019793..ab47e48 100644
--- a/stagit-index.c
+++ b/stagit-index.c
@@ -147,7 +147,6 @@ err:
 int
 main(int argc, char *argv[])
 {
-	const git_error *e = NULL;
 	FILE *fp;
 	char path[PATH_MAX], repodirabs[PATH_MAX + 1];
 	const char *repodir;
@@ -174,8 +173,7 @@ main(int argc, char *argv[])
 
 		if (git_repository_open_ext(&repo, repodir,
 		    GIT_REPOSITORY_OPEN_NO_SEARCH, NULL)) {
-			e = giterr_last();
-			fprintf(stderr, "%s: %s\n", argv[0], e->message);
+			fprintf(stderr, "%s: cannot open repository\n", argv[0]);
 			ret = 1;
 			continue;
 		}
diff --git a/stagit.c b/stagit.c
index 093cdab..c2b2f2c 100644
--- a/stagit.c
+++ b/stagit.c
@@ -1054,7 +1054,6 @@ main(int argc, char *argv[])
 {
 	git_object *obj = NULL;
 	const git_oid *head = NULL;
-	const git_error *e = NULL;
 	mode_t mask;
 	FILE *fp, *fpread;
 	char path[PATH_MAX], repodirabs[PATH_MAX + 1], *p;
@@ -1101,8 +1100,7 @@ main(int argc, char *argv[])
 
 	if (git_repository_open_ext(&repo, repodir,
 		GIT_REPOSITORY_OPEN_NO_SEARCH, NULL) < 0) {
-		e = giterr_last();
-		fprintf(stderr, "%s: %s\n", argv[0], e->message);
+		fprintf(stderr, "%s: cannot open repository\n", argv[0]);
 		return 1;
 	}
 
-- 
2.21.0

