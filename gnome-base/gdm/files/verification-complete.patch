From 76e2a54a1ef6cb8783844ce11efcf694e220a840 Mon Sep 17 00:00:00 2001
From: Ray Strode <rstrode@redhat.com>
Date: Tue, 20 Oct 2015 16:48:17 -0400
Subject: gdm-session: emit verification-complete even for logins

Right now we only emit verification-complete when the a user
successfully reauthenticates.  We should also do it when they
successfully initially authenticate.

This commit fixes that.

https://bugzilla.gnome.org/show_bug.cgi?id=754814
---
 daemon/gdm-session.c | 15 +++++++--------
 1 file changed, 7 insertions(+), 8 deletions(-)

diff --git a/daemon/gdm-session.c b/daemon/gdm-session.c
index 982b5eb..5530485 100644
--- a/daemon/gdm-session.c
+++ b/daemon/gdm-session.c
@@ -307,19 +307,18 @@ on_establish_credentials_cb (GdmDBusWorker *proxy,
         service_name = conversation->service_name;
 
         if (worked) {
-                switch (self->priv->verification_mode) {
-                case GDM_SESSION_VERIFICATION_MODE_REAUTHENTICATE:
-                        if (self->priv->user_verifier_interface != NULL) {
-                                gdm_dbus_user_verifier_emit_verification_complete (self->priv->user_verifier_interface,
-                                                                                   service_name);
-                                g_signal_emit (self, signals[VERIFICATION_COMPLETE], 0, service_name);
-                        }
-                        break;
+                if (self->priv->user_verifier_interface != NULL) {
+                        gdm_dbus_user_verifier_emit_verification_complete (self->priv->user_verifier_interface,
+                                                                           service_name);
+                        g_signal_emit (self, signals[VERIFICATION_COMPLETE], 0, service_name);
+                }
 
+                switch (self->priv->verification_mode) {
                 case GDM_SESSION_VERIFICATION_MODE_LOGIN:
                 case GDM_SESSION_VERIFICATION_MODE_CHOOSER:
                         gdm_session_open_session (self, service_name);
                         break;
+                case GDM_SESSION_VERIFICATION_MODE_REAUTHENTICATE:
                 default:
                         break;
                 }
-- 
cgit v0.11.2

