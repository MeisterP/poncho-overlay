From dda968ff34b749e430fbaddd68346eab46928e6f Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Quentin=20Pa=CC=82ris?= <git@qparis.fr>
Date: Sat, 22 Sep 2012 19:40:09 +0200
Subject: [PATCH 1/3] Bugfix

* Mulx's bug
* Pango's bug
* Bug 1352
---
 bash/first_use            | 14 ++++++++------
 bash/startup_after_server | 10 ++++++----
 python/mainwindow.py      |  4 ++--
 3 files changed, 16 insertions(+), 12 deletions(-)

diff --git a/bash/first_use b/bash/first_use
index 07cb301..0072698 100755
--- a/bash/first_use
+++ b/bash/first_use
@@ -256,12 +256,14 @@ else
 	fi
 fi
 
-if [ "$OSX_VERSION" = "11" -a "$OSX_SUB_VERSION" -gt "4" ] || [ "$OSX_VERSION" = "12" -a "$OSX_SUB_VERSION" -gt "1" ]; then
-	# XQuartz 2.7.4 is needed here... See http://bugs.winehq.org/show_bug.cgi?id=31751
-	XVERSION="$(cat "/Applications/Utilities/XQuartz.app/Contents/Info.plist" | grep -A1 "<key>CFBundleShortVersionString</key>" | tail -n1 | cut -d '>' -f2 | cut -d '<' -f1)"
-	if VersionLower "$XVERSION" "2.7.4"; then
-		export FORCE_X11_Reinstall="True"
-		install_x11
+if [ "$POL_OS" = "Mac" ]; then
+	if [ "$OSX_VERSION" = "11" -a "$OSX_SUB_VERSION" -gt "4" ] || [ "$OSX_VERSION" = "12" -a "$OSX_SUB_VERSION" -gt "1" ]; then
+		# XQuartz 2.7.4 is needed here... See http://bugs.winehq.org/show_bug.cgi?id=31751
+		XVERSION="$(cat "/Applications/Utilities/XQuartz.app/Contents/Info.plist" | grep -A1 "<key>CFBundleShortVersionString</key>" | tail -n1 | cut -d '>' -f2 | cut -d '<' -f1)"
+		if VersionLower "$XVERSION" "2.7.4"; then
+			export FORCE_X11_Reinstall="True"
+			install_x11
+		fi
 	fi
 fi 
 
diff --git a/bash/startup_after_server b/bash/startup_after_server
index fa436e3..0867e33 100644
--- a/bash/startup_after_server
+++ b/bash/startup_after_server
@@ -35,11 +35,13 @@ if [ ! "$(POL_Config_Read FIRST_USE)" = "TRUE" ]; then
 	bash "$PLAYONLINUX/bash/first_use"
 elif [ "$POL_OS" = "Mac" -a ! -e "/Applications/Utilities/XQuartz.app" -a "$OSX_VERSION" != "11" ]; then
 	bash "$PLAYONLINUX/bash/first_use"
-elif [ "$OSX_VERSION" = "11" -a "$OSX_SUB_VERSION" -gt "4" ] || [ "$OSX_VERSION" = "12" -a "$OSX_SUB_VERSION" -gt "1" ]; then
-	# XQuartz 2.7.4 is needed here... See http://bugs.winehq.org/show_bug.cgi?id=31751
-	XVERSION="$(cat "/Applications/Utilities/XQuartz.app/Contents/Info.plist" | grep -A1 "<key>CFBundleShortVersionString</key>" | tail -n1 | cut -d '>' -f2 | cut -d '<' -f1)"
-	if VersionLower "$XVERSION" "2.7.4"; then
+elif [ "$POL_OS" = "Mac" ]; then
+	if [ "$OSX_VERSION" = "11" -a "$OSX_SUB_VERSION" -gt "4" ] || [ "$OSX_VERSION" = "12" -a "$OSX_SUB_VERSION" -gt "1" ]; then
+		# XQuartz 2.7.4 is needed here... See http://bugs.winehq.org/show_bug.cgi?id=31751
+		XVERSION="$(cat "/Applications/Utilities/XQuartz.app/Contents/Info.plist" | grep -A1 "<key>CFBundleShortVersionString</key>" | tail -n1 | cut -d '>' -f2 | cut -d '<' -f1)"
+		if VersionLower "$XVERSION" "2.7.4"; then
 			bash "$PLAYONLINUX/bash/first_use"
+		fi
 	fi
 fi 
 
diff --git a/python/mainwindow.py b/python/mainwindow.py
index 7ffc3c4..7fa5db5 100755
--- a/python/mainwindow.py
+++ b/python/mainwindow.py
@@ -1012,7 +1012,7 @@ class MainWindow(wx.Frame):
         self.POLDie()
 
     def ClosePol(self, event):
-        if(wx.YES == wx.MessageBox(_('Are you sure you want to close all {0} Windows?').format(os.environ["APPLICATION_TITLE"]).decode("utf-8","replace"),os.environ["APPLICATION_TITLE"], style=wx.YES_NO | wx.ICON_QUESTION)):
+        if(playonlinux.GetSettings("DONT_ASK_BEFORE_CLOSING") == "TRUE" or wx.YES == wx.MessageBox(_('Are you sure you want to close all {0} Windows?').format(os.environ["APPLICATION_TITLE"]).decode("utf-8","replace"),os.environ["APPLICATION_TITLE"], style=wx.YES_NO | wx.ICON_QUESTION)):
             self.SizeToSave = self.GetSize();
             self.PositionToSave = self.GetPosition();
             # Save size and position
@@ -1182,7 +1182,7 @@ class PlayOnLinuxApp(wx.App):
                 if(wx.YES == wx.MessageBox(_('Do you want to help {0} to make a compatibility database?\n\nIf you click yes, the following things will be sent to us anonymously the first time you run a Windows program:\n\n- You graphic card model\n- Your OS version\n- If graphic drivers are installed or not.\n\n\nThese information will be very precious for us to help people.').format(os.environ["APPLICATION_TITLE"]).decode("utf-8","replace"), os.environ["APPLICATION_TITLE"],style=wx.YES_NO | wx.ICON_QUESTION)):
                     playonlinux.SetSettings("SEND_REPORT","TRUE")
                 else:
-                    playonlinux.SetSettings("SEND_REPORT","TRUE")
+                    playonlinux.SetSettings("SEND_REPORT","FALSE")
 
         #### Other import checks
         self.singleCheckFatal("nc", package="Netcat")
-- 
1.7.12

